const { loadFixture, } = require("@nomicfoundation/hardhat-toolbox/network-helpers");
const { ethers } = require("hardhat");
const { expect } = require("chai");
  
describe("Level10 - Elevator", function () {
    async function setUp() {
        const [owner, hacker] = await ethers.getSigners();

        const ElevatorContract = await ethers.deployContract("Elevator");
        const ElevatorAddress = await ElevatorContract.getAddress();
        
        const ExploitContract = await ethers.deployContract("Level11ElevatorExploit", [ElevatorAddress]);
        const ExploitAddress = await ExploitContract.getAddress();

        return {owner, hacker, ElevatorContract, ExploitContract, ElevatorAddress, ExploitAddress};
    };

    describe("Level11 hacking", () => {
        it("should allow the hacker to reach the top floor", async() => {
            const {owner, hacker, ElevatorContract, ExploitContract, ElevatorAddress, ExploitAddress} = await loadFixture(setUp);
            
            expect(await ElevatorContract.connect(hacker).top()).to.equal(false);

            await ExploitContract.attack();
            expect(await ElevatorContract.connect(hacker).top()).to.equal(true);
        }); 

    })

});